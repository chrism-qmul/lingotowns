<!DOCTYPE html>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<head>
    <script>
        window.dataLayer = window.dataLayer || [];

        data_point = Math.floor(Math.random() * 10)
        dataLayer.push({
            'event': 'test',
            'test_data_point': data_point
        })

    </script>
    <!-- Google Tag Manager -->
    <script>(function (w, d, s, l, i) {
                w[l] = w[l] || []; w[l].push({
                    'gtm.start':
                        new Date().getTime(), event: 'gtm.js'
                }); var f = d.getElementsByTagName(s)[0],
                    j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                        'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
            })(window, document, 'script', 'dataLayer', 'GTM-N7B3K6B');</script>
    <!-- End Google Tag Manager -->
    <meta charset="UTF-8">
    <link rel="stylesheet" src="/css/style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="stylesheet" href="https://use.typekit.net/frj5pjr.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mouse+Memoirs&display=swap" rel="stylesheet">
    <script src="/js/array.polyfill.js"></script>


    <title>LingoTowns | Play</title>
</head>

<style>
    html,
    body {
        position: fixed;
        overflow: hidden;
        min-height: 100vh;
        min-width: 100vw;
        margin: 0;
        padding: 0;
        user-select: none;
        font-family: sans-serif;
        color: black;
        font-family: nunito, sans-serif;
        font-weight: 400;
        font-style: normal;
        line-height: 1.5;
        height: 100vh;
        display: flex;
        /* align-items: center; */
        flex-direction: column;
        z-index: 10;
    }

    h5 {
        font-family: "Lato", sans-serif;
        font-weight: 400;
        font-size: 18px;
        margin-top: 10px;
        margin-right: 0px;
        margin-bottom: 10px;
        margin-left: 0px;
        /* margin: 10px;
        line-height: 1.5; */
    }

    h6 {
        font-family: "Lato", sans-serif;
        font-weight: 400;
        font-size: 15px;
    }


    .towninformation {
        max-width: 70vw;
    }

    .towninformation .content table.detail {
        table-layout: fixed;
        width: 100%;
    }

    .towninformation .content {
        width: 100%;
    }

    .towninformation table.detail th {
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        width: 30%;
        text-align: right;
    }

    .towninformation table.detail th {
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
    }

    .truncate {
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
    }

    iframe.gamewindow {
        position: absolute;
        border: 0px;
        left: 0px;
        width: 100vw;
        height: 100vh;
        z-index: 9990;
    }

    div#infopanel>div {
        margin: 1%;
        display: grid;
        grid-gap: 1px;
        grid-template-rows: 1fr 5fr;
        grid-template-columns: 1.62fr 1fr;
        height: 90%;
    }

    div#infopanel>div>* {
        /*background:white;*/
        margin: 0px;
    }

    .dragging #minimap {
        /*  transform:translate(50vw 0vh) translate(-50% 0%);*/
    }

    #infopanel dl.info {
        display: flex;
        flex-direction: row;
        flex-wrap: nowrap;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid grey;
        grid-column: 1 / span 2;
    }

    #infopanel dl.info dt,
    #infopanel dl.info dd {
        margin: 0px;
    }

    #infopanel dl.info dt {
        margin: 0px;
    }

    #infopanel dl.info dd {
        flex-grow: 1;
        padding-left: 1em;
        color: #222;
    }

    #infopanel dl.info dd:last-child {
        flex-grow: 0;
    }

    #infopanel .progress {
        grid-row: 2;
        grid-column: 1;
    }

    #infopanel .worldmap {
        grid-row: 2;
        grid-column: 2;
        padding-left: 1em;
    }

    button.gameclosebutton {
        position: absolute;
        left: 20px;
        top: 20px;
        z-index: 9999;
    }

    dl.table {
        display: grid;
        grid-gap: 0.5em;
        grid-template-columns: 1fr 4fr;
    }

    dl.table dd {
        margin: 0px;
    }

    .progress-bar {
        background: #8642fe00;
        position: relative;
        overflow: hidden;
        width: 100%;
        height: 18px;
        border-radius: 3px;
        border: 1px solid black;
    }

    .progress-bar span {
        position: absolute;
        text-align: center;
        display: inline-block;
        width: 100%;
        font-size: 10px;
    }

    .progress-bar .bar {
        position: absolute;
        background: #8642fe80;
        transition: width 1s ease-in-out;
        height: 100%;
    }

    .gameoverlay {
        position: absolute;
        z-index: 5;
        border-radius: 5px;
        border: 1px solid white;
        color: white;
        background: rgba(0, 0, 0, .5);
    }

    .gameoverlay h2 {
        padding-top: 0px;
        margin-top: 0px;
    }

    .gameoverlay button,
    .gameoverlay a.button {
        border: 0px;
        width: 100%;
        border-radius: 0px;
        padding: 5px;
        margin: 0px;
    }

    .btn {
        border-radius: 5px;
        background: black;
        color: white;
        padding: 5px;
        border: 1px solid black;
        display: inline-block;
        padding-right: 5px;
        padding-left: 5px;
        text-decoration: none;
    }

    .btn.secondary {
        background: none;
        color: black;
    }

    .gameoverlay .content {
        margin: 5px;
    }

    .gameoverlay .townicon {
        position: relative;
        height: 0px;
        width: 100%;
        background: black;
        overflow: visible;
        top: 0px;
    }

    .gameoverlay .townicon img {
        position: absolute;
        left: 50%;
        filter: drop-shadow(0px 0px 12px black);
        transform: translate(-50%, 0);
        z-index: -1;
        bottom: -2px;
    }

    #app {
        width: 100vw;
        height: 100vh;
    }

    div#infopanel {
        position: absolute;
        z-index: 10;
        bottom: 0px;
        width: 100vw;
        height: 38.2vh;
        background: white;
        box-shadow: 0px -0vh 1vh 1vh rgba(0, 0, 0, .6);
    }

    #edge_of_playarea {
        position: absolute;
        display: none;
        z-index: 10;
        top: 50vh;
        left: 50vw;
        transform: translate(-50%, -50%);
        text-align: center;
        border-radius: 5px;
        border: 1px solid white;
        color: white;
        background: rgba(0, 0, 0, .5);
    }

    #edge_of_playarea .content {
        margin: 5px;
    }

    @media (orientation: landscape) {
        #app {
            height: 100vh;
        }

        div#infopanel {
            top: 61.2vh;
            width: 38.2vw;
            border-radius: 5px;
            left: 30.6vw;
            bottom: 14.6vh;
        }

        .dragging div#infopanel {
            background: rgba(255, 255, 255, 0.0);
            position: absolute;
            color: rgba(0, 0, 0, 0);
            left: 61.8vw;
            /*transform:translate(-100%, 0%);*/
            transition: left 0.3s linear;
            box-shadow: none;
        }

        .dragging div#infopanel dl.table {
            display: none;
        }

        .dragging div#infopanel dl.info {
            display: none;
        }
    }

    #maintitle {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        font-size: 20vw;
        margin-top: -10vw;
        z-index: 999;
        filter: drop-shadow(0px 0px 13px black);
        font-family: 'Mouse Memoirs';
        background-image: linear-gradient(0deg, #ffa006, #ffd156);
        -webkit-text-fill-color: transparent;
        -moz-text-fill-color: transparent;
        -webkit-background-clip: text;
        -moz-background-clip: text;
        pointer-events: none;
        padding-top: 20%;
        padding-bottom: 20%;
    }

    .afterload {
        opacity: 0;
        transition: opacity 2s linear;
    }

    .beforeload {
        opacity: 1;
        transition: opacity 2s linear;
    }

    .loaded .afterload {
        opacity: 1;
    }

    .loaded .beforeload {
        opacity: 0;
    }

    #loginreminder {
        transform: translate(0%, 0);
        color: #222;
        box-shadow: 5px 0px #000;
        position: fixed;
        bottom: 0px;
        left: 0px;
        width: 100vw;
        background: rgba(255, 255, 255, 0.9);
        z-index: 9999;
        transition: transform 1s;
    }

    #loginreminder p {
        line-height: 2em;
        margin: 10px;
    }

    #loginreminder.close {
        transform: translate(0%, 100%);
    }

    .nav-bar {
        /* width: 3.5em; */
        /* height: 47px; */
        position: fixed;
        border-radius: 23px ! important;
        /* border-radius: 30%; */
        top: 0;
        /* margin: 1%; */
        left: 0;
        margin: 1%;
        padding-top: 11px;
        padding-right: 18px;
        padding-bottom: 11px;
        padding-left: 18px;
        box-shadow: 0 3px 12px -1px rgb(134 66 254 / 42%), 3px 8px 29px 0 rgb(0 0 0 / 14%);
        background: #f2f6ff;
        /* margin-top: -30%; */
        /* background-image: linear-gradient(45deg, #c7c5ef, #96b5ec, #4379d3, #4354d0); */
        /* background-size: 200% 200%; */
        z-index: 999999;
        /* display: none; */
        /* box-shadow: rgba(100, 100, 111, 0.5) 0px 7px 29px 0px; */
        /* padding-top: 1%; */

    }


    #menu-button {
        /* width: 10%; */
        height: 100%;
        background-color: rgba(245, 245, 245, 0);
        /* margin: 5%; */
        border: none;
        cursor: pointer;
        overflow: visible;
        align-items: center;
        padding: 0%;


    }

    #menu-button svg {
        width: 24px;
        height: 24px;
        /* padding-top: 20%; */
        float: left;
        /* margin-left: 15%;
        padding-bottom: 20%; */
        fill: #2a2a2a;
        overflow: visible;
    }

    .nav-bar-expanded {
        position: fixed;
        width: 20em;
        height: 30em;
        z-index: 9999999;
        top: 0%;
        /* margin-top: -50%; */
        border-radius: 0% 2% 2% 0%;
        box-shadow: rgba(91, 0, 165, 0.212) 0px 7px 20px 0px;
        /* display: none; */
        overflow: hidden;
        /* margin-left: -40vh; */
        animation-name: menu-show;
        animation-duration: 0.5s;
        /* animation-direction: forwards; */
        background-color: whitesmoke;
        /* animation-fill-mode: forwards; */


    }

    @keyframes menu-show {
        from {
            margin-left: -50vh;
        }

        to {
            margin-left: 0vh;
        }
    }

    @keyframes menu-hide {
        from {
            margin-left: 0vh;
        }

        to {
            margin-left: -50vh;
        }
    }

    .overlay {
        height: 100%;
        width: 100%;
        z-index: 99999;
        position: fixed;
        cursor: pointer;
        display: none;
        background-color: rgba(0, 0, 0, 0.37);
    }

    #close-button {
        width: 20%;
        height: 100%;
        background-color: rgba(245, 245, 245, 0);
        border: none;
        cursor: pointer;
        /* top: 10%; */
        float: right;
        /* padding-left: 30%; */
        padding: 5%;

    }

    #close-button svg {
        width: 20px;
        height: 20px;
        padding-top: 5%;
        fill: rgba(0, 0, 0, 0.664);
    }

    /* .close-wrapper {


} */

    .menu-footer {
        position: absolute;
        bottom: 0%;
        width: 100%;
        height: 15%;
        background-color: whitesmoke;
        box-shadow: rgba(63, 1, 114, 0.342) 0px 7px 20px 0px;

    }

    .menu-items-wrapper {

        padding-left: 15%;
        padding-right: 15%;
        padding-top: 10%;
        text-transform: uppercase;
        font-family: nunito, sans-serif;

        font-weight: 400;

        font-style: normal;

    }

    .nav-bar-expanded-wrapper {

        overflow: hidden;
        display: none;
    }

    .menu-wrapper {

        line-height: 0%;
    }

    .menu-items {


        width: 100%;
        padding-left: 5%;
        padding-top: 4%;
        padding-bottom: 4%;
        cursor: pointer;
        margin: 5%;
    }

    .menu-items:hover {
        background-color: lightgray;
        border-radius: 2%;
    }


    ul {
        list-style-type: none;
        margin: 0;
        padding: 0;
    }

    .Line-2-Copy-3 {
        width: 246px;
        /* height: 1px; */
        opacity: 0.1;
        border: solid 0.5px #000;
        margin-bottom: 15%;
    }

    .menu-next {

        height: 10px;
        fill: black;
        margin-top: 2%;
        margin-right: 5%;
        float: right;
    }

    a {

        text-decoration: none;
        color: inherit;
    }


    .logout-button {
        align-items: center;
        appearance: none;
        background-color: #fff;
        border-radius: 24px;
        border-style: none;
        box-shadow: rgba(0, 0, 0, .2) 0 3px 5px -1px, rgba(0, 0, 0, .14) 0 6px 10px 0, rgba(0, 0, 0, .12) 0 1px 18px 0;
        box-sizing: border-box;
        color: #3c4043;
        cursor: pointer;
        display: inline-flex;
        fill: currentcolor;
        font-family: "Google Sans", Roboto, Arial, sans-serif;
        font-size: 14px;
        font-weight: 500;
        height: 48px;
        justify-content: center;
        letter-spacing: .25px;
        line-height: normal;
        max-width: 100%;
        overflow: visible;
        padding: 2px 24px;
        position: absolute;
        text-align: center;
        text-transform: none;
        transition: box-shadow 280ms cubic-bezier(.4, 0, .2, 1), opacity 15ms linear 30ms, transform 270ms cubic-bezier(0, 0, .2, 1) 0ms;
        user-select: none;
        -webkit-user-select: none;
        touch-action: manipulation;
        width: auto;
        will-change: transform, opacity;
        z-index: 0;
        margin-left: 60%;
    }

    .logout-button:hover {
        background: #F6F9FE;
        color: #174ea6;
    }

    .logout-button:active {
        box-shadow: 0 4px 4px 0 rgb(60 64 67 / 30%), 0 8px 12px 6px rgb(60 64 67 / 15%);
        outline: none;
    }

    .logout-button:focus {
        outline: none;
        border: 2px solid #4285f4;
    }

    .logout-button:not(:disabled) {
        box-shadow: rgba(60, 64, 67, .3) 0 1px 3px 0, rgba(60, 64, 67, .15) 0 4px 8px 3px;
    }

    .logout-button:not(:disabled):hover {
        box-shadow: rgba(60, 64, 67, .3) 0 2px 3px 0, rgba(60, 64, 67, .15) 0 6px 10px 4px;
    }

    .logout-button:not(:disabled):focus {
        box-shadow: rgba(60, 64, 67, .3) 0 1px 3px 0, rgba(60, 64, 67, .15) 0 4px 8px 3px;
    }

    .logout-button:not(:disabled):active {
        box-shadow: rgba(60, 64, 67, .3) 0 4px 4px 0, rgba(60, 64, 67, .15) 0 8px 12px 6px;
    }

    .logout-button:disabled {
        box-shadow: rgba(60, 64, 67, .3) 0 1px 3px 0, rgba(60, 64, 67, .15) 0 4px 8px 3px;
    }
</style>

<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N7B3K6B" height="0" width="0"
            style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <div id="nav-bar-expanded-wrapper" class="nav-bar-expanded-wrapper">
        <div class="nav-bar-expanded">
            <div class="close-wrapper"><button id="close-button" onclick="hideMenu()"><svg id="close-icon"
                        class="close-icon" version="1.1" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="m88.854 85.845-33.487-34.785 33.487-34.785c1.8399-1.906 1.8399-4.8604 0-6.7665-1.8399-1.906-4.6919-1.906-6.5318 0l-33.487 34.785-33.487-34.69c-1.8399-1.906-4.6919-1.906-6.5318 0-1.8399 1.906-1.8399 4.8604 0 6.7665l33.487 34.69-33.487 34.785c-1.8399 1.906-1.8399 4.8604 0 6.7665 1.8399 1.906 4.6919 1.906 6.5318 0l33.487-34.785 33.579 34.785c1.8399 1.906 4.6919 1.906 6.5318 0 1.748-1.906 1.748-4.9557-0.092-6.7665z"
                            stroke-width=".93635" />
                    </svg></button></div>
            <div class="menu-items-wrapper">
                <ul>
                    <h5>Menu</h5>
                    <div class="Line-2-Copy-3"></div>
                    <a id="menu-about-link" href="https://lingotowns.com/#about">
                        <div class="menu-items">
                            <li>About<img class="menu-next" src="http://phrasefarm.org/img/menu-next.svg"
                                    title="menu next icon"></li>
                        </div>
                    </a>
                    <a id="menu-updates-link" href="https://lingotowns.com/#updates">
                        <div class="menu-items">
                            <li>Updates<img class="menu-next" src="http://phrasefarm.org/img/menu-next.svg"
                                    title="menu next icon"></li>
                        </div>
                    </a>
                    <a id="menu-DALI-link" href="https://lingotowns.com/#DALI">
                        <div class="menu-items">
                            <li>The Science of DALI<img class="menu-next" src="http://phrasefarm.org/img/menu-next.svg"
                                    title="menu next icon"></li>
                        </div>
                    </a>
                </ul>


            </div>
            <div class="menu-footer">
                <div style="padding-top: 3%; padding-left: 5%; height: 100%; width: 80%; position: relative;">
                    {% if logged_in %}
                    <h6 style="margin-top: 5%; width: 20%; display: inline-block;">{{username}}</h6><a id='logout'
                        class="logout-button" href='/logout'>logout</a>
                    {% else %}
                    <h6 style="margin-top: 5%; width: 20%; display: inline-block;">Guest</h6><a id='logout'
                        class="logout-button"
                        onclick="window.location.href='https://auth.tileattack.com/login?redirect=https://lingotowns.com/play'">login</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <div id="overlay" class="overlay" onclick="hideMenu()"></div>
    <div class="nav-bar">
        <div class="menu-wrapper"><button id="menu-button" onclick="showMenu()"><svg id="menu-icon" class="menu-icon"
                    version="1.1" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <g transform="matrix(1.2076 0 0 1.331 -9.584 -1285.7)">
                        <path
                            d="m16 979.37c-1.6568 0-3 1.3431-3 3 0 1.6568 1.3432 3 3 3h68c1.6568 0 3-1.3432 3-3 0-1.6569-1.3432-3-3-3zm0 21c-1.6568 0-3 1.3431-3 3 0 1.6568 1.3432 3 3 3h68c1.6568 0 3-1.3432 3-3 0-1.6569-1.3432-3-3-3zm0 21c-1.6568 0-3 1.3431-3 3 0 1.6568 1.3432 3 3 3h68c1.6568 0 3-1.3432 3-3 0-1.6569-1.3432-3-3-3z"
                            color="#000000" overflow="visible" style="text-indent:0;text-transform:none" />
                    </g>
                </svg></button></div>
    </div>
    <h1 id="maintitle" class="beforeload">LingoTowns</h1>
    <canvas id="app" width="500" height="500"></canvas>
    <canvas style="border:1px solid black;position:absolute;bottom:2vh;right:2vh;background:white;z-index:100;"
        id="minimap" width="200" height="200"></canvas>
    <div id="edge_of_playarea">
        <div class='content'>
            <i class="bi bi-exclamation-triangle"></i>&nbsp;<b>Warning:</b> You're nearing the edge of the play area,
            click here to go home!
        </div>
    </div>
    {% if is_guest %}
    <div id="loginreminder" class="close">
        <p>Hey there, you're currently playing as a guest - Would you like to register so we can keep track of your
            scores? <a class="btn"
                href="https://auth.tileattack.com/create-account?redirect=https://lingotowns.com">Yes</a>&nbsp;<a
                id="loginreminderclose" href="#" class="btn secondary">No thanks</a></p>
    </div>
    {% endif %}






    <script src="{{auth_server}}/auth.js"></script>
    <script src="https://cdn.socket.io/3.1.3/socket.io.min.js"
        integrity="sha384-cPwlPLvBTa3sKAgddT6krw0cJat7egBga3DJepJyrLl4Q9/5WLra3rrnMcyTyOnh"
        crossorigin="anonymous"></script>
    <script type="module" src="/js/game.js"></script>
    <script type="module" src="/js/homepage.js"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/Swiper/6.4.5/swiper-bundle.min.js'></script>
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <script src="https://unpkg.com/@lottiefiles/lottie-interactivity@latest/dist/lottie-interactivity.min.js"></script>
</body>

</html>